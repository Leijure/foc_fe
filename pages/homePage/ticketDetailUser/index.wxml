<!--index.wxml-->
<scroll-view class="scrollview" scroll-y type="list">
  <view class="container">
    <view class="step-container">
      <van-steps steps="{{ steps }}" active="{{ active }}" active-icon="success" active-color="#38f" />
    </view>
    <view wx:if="{{ ticket !== null }}" class="table-container">
      <van-cell-group wx:if="{{ ticket.assigned_technician_id !== null }}" inset title="技术员联系方式">
        <van-cell wx:if="{{ ticket.assigned_technician_id !== null }}" center title="技工号"
          value="{{ ticket.assigned_technician_id }}">
          <copy-button text-to-copy="{{ ticket.assigned_technician_id }}" slot="right-icon" />
        </van-cell>
        <van-cell wx:if="{{ ticket.assigned_time !== null }}" l center title="分配时间" value="{{ ticket.assigned_time }}">
          <copy-button text-to-copy="{{ ticket.assigned_time }}" slot="right-icon" />
        </van-cell>
        <van-cell wx:if="{{ ticket.completion_time !== null }}" center title="完成时间"
          value="{{ ticket.completion_time }}">
          <copy-button text-to-copy="{{ ticket.completion_time }}" slot="right-icon" />
        </van-cell>
      </van-cell-group>
      <van-cell-group inset title="工单维修信息">
        <van-cell center title="图片" title-width="200rpx">
          <view class="image-container" wx:for="{{ [ticket.repair_image_url] }}" wx:key="id">
            <van-image width="5rem" height="5rem" fit="cover" src="{{ item }}" bind:click="previewImage"
              data-src="{{ item }}">
            </van-image>
          </view>
        </van-cell>
        <van-cell center title="所在校区" value="{{ ticket.campus }}">
          <copy-button text-to-copy="{{ ticket.campus }}" slot="right-icon" />
        </van-cell>
        <van-cell center title="设备类型" value="{{ ticket.device_type }}">
          <copy-button text-to-copy="{{ ticket.device_type }}" slot="right-icon" />
        </van-cell>
        <van-cell center title="设备品牌" value="{{ ticket.computer_brand }}">
          <copy-button text-to-copy="{{ ticket.computer_brand }}" slot="right-icon" />
        </van-cell>
        <van-cell center title="保修状态" value="{{ warrantyMap[ticket.warranty_status] }}">
          <copy-button text-to-copy="{{ '过保' }}" slot="right-icon" />
        </van-cell>
        <van-cell center title="设备问题" value="{{ ticket.fault_type }}">
          <copy-button text-to-copy="{{ ticket.fault_type }}" slot="right-icon" />
        </van-cell>
        <van-cell center title="购买日期" value="{{ ticket.machine_purchase_date }}">
          <copy-button text-to-copy="{{ ticket.machine_purchase_date }}" slot="right-icon" />
        </van-cell>
        <!-- 说出设备型号门槛过高 省略...-->
        <van-cell center title="问题描述" value="{{ ticket.repair_description }}">
          <copy-button text-to-copy="{{ ticket.repair_description }}" slot="right-icon" />
        </van-cell>
      </van-cell-group>
    </view>
    <view
      wx:if="{{ ticket.repair_status !== 'Done' && ticket.repair_status !== 'Canceled' && ticket.repair_status !== 'Closed' }}"
      class="qrcode-container" bind:tap="previewQRcode">
      <canvas class='canvas' canvas-id='canvas'>
      </canvas>
      <view class="tips">技术员扫码可面对面接单</view>
    </view>
    <view
      wx:if="{{ ticket.repair_status !== 'Done' && ticket.repair_status !== 'Canceled' && ticket.repair_status !== 'Closed' }}"
      class="btn-container">
      <van-button round icon="delete_forever" class-prefix="material-icons" type="warning" bind:click="cancelTheTicket">
        取消工单
      </van-button>
    </view>
  </view>
  <van-dialog id="van-dialog" />
  <van-toast id="van-toast" />
</scroll-view>
